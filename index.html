<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookshelves | Connect</title>
    <style>
        :root {
            --mac-bg: #f5f5f7;
            --mac-card: #ffffff;
            --accent: #007aff;
            --gray-text: #86868b;
            --border: rgba(0,0,0,0.1);
        }

        body {
            margin: 0; background: var(--mac-bg);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .window {
            width: 440px; background: var(--mac-card); border-radius: 18px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.12); overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05); position: relative;
        }

        /* 1. ìƒë‹¨ë°” ë””ìì¸ ìˆ˜ì • (Bookshelves í…ìŠ¤íŠ¸ & í‘ë°± í™”ì‚´í‘œ) */
        .title-bar {
            height: 48px; background: #fdfdfd; display: flex; align-items: center;
            padding: 0 20px; border-bottom: 0.5px solid #efefef;
        }
        .dots { display: flex; gap: 8px; width: 60px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .dot.red { background: #ff5f57; } .dot.yellow { background: #ffbd2e; } .dot.green { background: #28c940; }
        
        .bar-title { flex: 1; text-align: center; font-size: 13px; font-weight: 600; color: #1d1d1f; }

        .nav-controls { display: flex; gap: 15px; width: 60px; justify-content: flex-end; }
        .nav-btn {
            background: none; border: none; font-size: 18px; cursor: pointer;
            color: #d2d2d7; transition: color 0.2s; padding: 0; line-height: 1;
        }
        .nav-btn.active { color: #1d1d1f; } /* í™”ì‚´í‘œ í‘ë°± ë³€ê²½ */
        .check-icon { font-size: 16px; font-weight: bold; display: none; }

        /* ì»¨í…ì¸  ì˜ì—­ */
        .step-container { padding: 45px; min-height: 300px; display: none; }
        .step-container.active { display: block; animation: fadeIn 0.4s ease; }

        h1 { font-size: 24px; font-weight: 700; margin: 0 0 12px 0; letter-spacing: -0.8px; }
        p.desc { font-size: 14px; color: var(--gray-text); margin-bottom: 32px; line-height: 1.5; }
        
        .link-sub { font-size: 12px; color: var(--gray-text); margin-top: 8px; text-decoration: none; display: inline-block; }
        .link-sub:hover { text-decoration: underline; color: var(--accent); }

        .input-group { margin-bottom: 24px; }
        label { display: block; font-size: 11px; font-weight: 700; color: var(--gray-text); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        input, select {
            width: 100%; padding: 14px 16px; border-radius: 12px; border: 1.5px solid #efefef;
            background: #fbfbfd; font-size: 15px; outline: none; box-sizing: border-box; transition: 0.2s;
        }
        input:focus { border-color: #1d1d1f; background: #fff; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="window">
    <div class="title-bar">
        <div class="dots">
            <div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div>
        </div>
        <div class="bar-title">Bookshelves</div>
        <div class="nav-controls">
            <button class="nav-btn" id="prevBtn" onclick="moveStep(-1)">â†</button>
            <button class="nav-btn active" id="nextBtn" onclick="moveStep(1)">â†’</button>
            <button class="nav-btn" id="finishBtn" onclick="finish()" style="display:none;">âœ“</button>
        </div>
    </div>

    <div class="step-container active" id="step1">
        <h1>Connect Notion</h1>
        <p class="desc">â˜… ìš°ì„  API í† í°ì„ ë°œê¸‰ë°›ê³ , ì•„ì¹´ì´ë¹™ì— ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ì™€ ì—°ë™í•´ì£¼ì„¸ìš”.</p>
        <div class="input-group">
            <label>Internal Integration Token</label>
            <input type="password" id="notion-token" placeholder="secret_xxxxxxx">
            <a href="https://www.notion.so/profile/integrations" target="_blank" class="link-sub">ë‚´ ì¸í‹°ê·¸ë ˆì´ì…˜ ë°”ë¡œê°€ê¸° â†—</a>
        </div>
    </div>

    <div class="step-container" id="step2">
        <h1>Select Library</h1>
        <p class="desc" style="color:#d2d2d7; font-size: 13px; margin-top: -8px; margin-bottom: 20px;">Select your Database.</p>
        <p class="desc">ë„ì„œë¥¼ ì €ì¥í•  ë°ì´í„°ë² ì´ìŠ¤(BOOK DB)ë¥¼ ëª©ë¡ì—ì„œ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
        <div class="input-group">
            <label>Available Databases</label>
            <select id="db-select"><option value="">Loading...</option></select>
        </div>
    </div>

    <div class="step-container" id="step3">
        <h1>Personalize</h1>
        <p class="desc">Insert your personal TTB key.</p>
        <div class="input-group">
            <label>Aladin TTB Key</label>
            <input type="text" id="ttb-key" placeholder="ttbxxxxxxx">
        </div>
    </div>

    <div class="step-container" id="step4">
        <h1>Widget Design</h1>
        <p class="desc">ìœ„ì ¯ì˜ ì„¸ë¶€ ë””ìì¸ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
        </div>
</div>

<script>
    const SERVER_URL = "https://bookshelves-server.onrender.com";
    let currentStep = 1;

    async function moveStep(step) {
        const next = currentStep + step;
        if (step === 1) {
            if (currentStep === 1) {
                const token = document.getElementById('notion-token').value;
                if (!token) return alert('í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                await loadDatabases(token);
            }
            if (currentStep === 2 && !document.getElementById('db-select').value) return alert('DBë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
        }

        if (next >= 1 && next <= 4) {
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${next}`).classList.add('active');
            currentStep = next;
            updateNav();
        }
    }

    function updateNav() {
        document.getElementById('prevBtn').classList.toggle('active', currentStep > 1);
        document.getElementById('nextBtn').style.display = currentStep === 4 ? 'none' : 'block';
        document.getElementById('finishBtn').style.display = currentStep === 4 ? 'block' : 'none';
        document.getElementById('finishBtn').classList.add('active');
    }

    async function loadDatabases(token) {
        const select = document.getElementById('db-select');
        try {
            const res = await fetch(`${SERVER_URL}/api/notion/databases`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token })
            });
            const dbs = await res.json();
            select.innerHTML = dbs.map(db => `<option value="${db.id}">${db.title}</option>`).join('');
        } catch (e) {
            alert('ì—°ê²° ì‹¤íŒ¨! í† í°ê³¼ í˜ì´ì§€ ì—°ë™ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            moveStep(-1);
        }
    }

    function finish() {
        alert('ë³µì‚¬ ì™„ë£Œ! ë…¸ì…˜ì—ì„œ /embed í•´ì£¼ì„¸ìš”. ğŸ¤');
    }
</script>
</body>
</html>
