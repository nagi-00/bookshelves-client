<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookshelves | Connect</title>
    <style>
        :root { --gray: #86868b; --dot-r: #f3aeaf; --dot-y: #f7e3af; --dot-g: #b1d9b7; }
        body { 
            margin: 0; 
            background: linear-gradient(180deg, #f5f5f7 0%, #e5e5e7 100%); 
            font-family: -apple-system, sans-serif; 
            display: flex; justify-content: center; align-items: center; min-height: 100vh; 
        }
        .window { width: 90%; max-width: 440px; background: #fff; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); overflow: hidden; }
        .title-bar { height: 52px; background: #fff; display: flex; align-items: center; padding: 0 20px; border-bottom: 0.5px solid #efefef; }
        .dots { display: flex; gap: 8px; width: 60px; } 
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .dot.r { background: var(--dot-r); } .dot.y { background: var(--dot-y); } .dot.g { background: var(--dot-g); }
        .bar-title { flex: 1; text-align: center; font-size: 14px; font-weight: 600; color: #1d1d1f; }
        
        /* ë½€ëª¨ë„ë¡œ ì¿ ì»¤ ìŠ¤íƒ€ì¼ í™”ì‚´í‘œ ë²„íŠ¼ */
        .nav-controls { display: flex; gap: 8px; width: 64px; justify-content: flex-end; }
        .circle-btn { 
            width: 28px; height: 28px; border-radius: 50%; 
            border: 1px solid #d2d2d7; background: none; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; color: #86868b;
            transition: all 0.2s ease; padding: 0;
        }
        .circle-btn:hover:not(:disabled) { border-color: #1d1d1f; color: #1d1d1f; }
        .circle-btn:disabled { opacity: 0.3; cursor: default; }
        .circle-btn svg { width: 14px; height: 14px; }

        .step { padding: 40px; display: none; min-height: 320px; animation: fadeIn 0.3s ease; } 
        .step.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1 { font-size: 22px; margin: 0 0 8px; color: #1d1d1f; } 
        .desc { font-size: 14px; color: var(--gray); margin-bottom: 25px; line-height: 1.5; }
        input, select { 
            width: 100%; padding: 14px; border-radius: 12px; border: 1.5px solid #efefef; 
            background: #fbfbfd; font-size: 15px; outline: none; box-sizing: border-box; transition: border-color 0.2s;
        }
        input:focus { border-color: #1d1d1f; }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s; }
        .color-dot:hover { transform: scale(1.1); }
        .color-dot.selected { border-color: #1d1d1f; box-shadow: 0 0 0 2px #fff inset; }
    </style>
</head>
<body>
<div class="window">
    <div class="title-bar">
        <div class="dots"><div class="dot r"></div><div class="dot y"></div><div class="dot g"></div></div>
        <div class="bar-title">Bookshelves</div>
        <div class="nav-controls">
            <button class="circle-btn" id="pBtn" onclick="mv(-1)" disabled>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 18l-6-6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="circle-btn" id="nBtn" onclick="mv(1)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
    </div>

    <div class="step active" id="s1">
        <h1>Connect Notion</h1>
        <p class="desc">â˜… ìš°ì„  API í† í°ì„ ë°œê¸‰ë°›ê³ , ì•„ì¹´ì´ë¹™ í˜ì´ì§€ì™€ ì—°ë™í•´ì£¼ì„¸ìš”.</p>
        <input type="password" id="tk" placeholder="secret_xxxx" onkeypress="if(event.keyCode==13)mv(1)">
        <a href="https://www.notion.so/profile/integrations" target="_blank" style="font-size:11px; color:var(--gray); text-decoration:none; margin-top:15px; display:block;">ë‚´ ì¸í‹°ê·¸ë ˆì´ì…˜ ë°”ë¡œê°€ê¸° â†—</a>
    </div>

    <div class="step" id="s2">
        <h1>Select Library</h1>
        <p class="desc">ë„ì„œë¥¼ ì €ì¥í•  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
        <select id="db"></select>
    </div>

    <div class="step" id="s3">
        <h1>Personalize</h1>
        <p class="desc">ì•Œë¼ë”˜ TTB í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
        <input type="text" id="ttb" placeholder="ttbxxx" onkeypress="if(event.keyCode==13)mv(1)">
    </div>

    <div class="step" id="s4">
        <h1>Design</h1>
        <p class="desc">ìœ„ì ¯ì˜ í…Œë§ˆ ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”.</p>
        <div style="display:flex; gap:12px; flex-wrap: wrap;" id="pal"></div>
    </div>
</div>

<script>
    let step = 1; 
    let selCol = "f7cbd6";
    const colors = ['f7cbd6', 'f9d5bb', 'ffffff', 'f6e8b1', 'b4e4c0', 'aac4f2'];
    const SERVER = "https://bookshelves-server.onrender.com";

    window.onload = () => {
        const pal = document.getElementById('pal');
        pal.innerHTML = colors.map(c => `<div class="color-dot" style="background:#${c};" onclick="sel('${c}')" id="c-${c}"></div>`).join('');
        sel(selCol);
    };

    function sel(c) { 
        selCol = c; 
        document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('selected'));
        document.getElementById('c-'+c).classList.add('selected');
    }

    async function mv(n) {
        if(n === 1 && step === 1) {
            const tkVal = document.getElementById('tk').value;
            if(!tkVal) return alert('í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            
            // ë°ì´í„°ë² ì´ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸°
            const res = await fetch(SERVER + '/api/notion/databases', { 
                method: 'POST', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify({ token: tkVal }) 
            });
            const dbs = await res.json();
            
            // ë¬¸ì œ í•´ê²°: ë°±í‹± ì•ˆì˜ ${} ì¶©ëŒì„ í”¼í•˜ê¸° ìœ„í•´ ë¶„ë¦¬í•´ì„œ ì²˜ë¦¬
            let options = "";
            dbs.forEach(item => {
                options += '<option value="' + item.id + '">' + item.title + '</option>';
            });
            document.getElementById('db').innerHTML = options;
        }

        if(step + n === 5) return fin();
        
        document.getElementById('s' + step).classList.remove('active');
        step += n;
        document.getElementById('s' + step).classList.add('active');
        
        // ë²„íŠ¼ í™œì„±í™” ì²˜ë¦¬
        document.getElementById('pBtn').disabled = (step === 1);
    }

    function fin() {
        const params = new URLSearchParams({ 
            t: btoa(document.getElementById('tk').value), 
            d: btoa(document.getElementById('db').value), 
            k: btoa(document.getElementById('ttb').value), 
            bg: selCol 
        });
        const finalUrl = SERVER + '/widget?' + params.toString();
        navigator.clipboard.writeText(finalUrl);
        alert('ì„¤ì • ì™„ë£Œ! ë³µì‚¬ëœ URLì„ ë…¸ì…˜ì— /embed í•˜ì„¸ìš”. ğŸ¤');
    }
</script>
</body>
</html>
