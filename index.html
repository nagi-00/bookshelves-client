<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookshelves | Connect</title>
    <style>
        :root { --gray: #86868b; --dot-r: #f3aeaf; --dot-y: #f7e3af; --dot-g: #b1d9b7; }
        body { margin: 0; background: #f5f5f7; font-family: -apple-system, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .window { width: 90%; max-width: 440px; background: #fff; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); overflow: hidden; }
        .title-bar { height: 52px; background: #fff; display: flex; align-items: center; padding: 0 20px; border-bottom: 0.5px solid #efefef; position: relative; }
        .dots { display: flex; gap: 8px; width: 60px; } .dot { width: 12px; height: 12px; border-radius: 50%; }
        .dot.r { background: var(--dot-r); } .dot.y { background: var(--dot-y); } .dot.g { background: var(--dot-g); }
        .bar-title { flex: 1; text-align: center; font-size: 14px; font-weight: 500; }
        .nav-controls { display: flex; gap: 10px; width: 60px; justify-content: flex-end; }
        /* ë™ê·¸ë€ í™”ì‚´í‘œ ë²„íŠ¼ */
        .circle-btn { width: 28px; height: 28px; border-radius: 50%; border: 1.5px solid #d2d2d7; background: none; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #d2d2d7; }
        .circle-btn.active { border-color: #1d1d1f; color: #1d1d1f; }
        .step { padding: 40px; display: none; min-height: 300px; } .step.active { display: block; }
        h1 { font-size: 22px; margin: 0 0 8px; } .desc { font-size: 14px; color: var(--gray); margin-bottom: 25px; line-height: 1.5; }
        input, select { width: 100%; padding: 12px; border-radius: 12px; border: 1.5px solid #efefef; background: #fbfbfd; font-size: 15px; outline: none; box-sizing: border-box; }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        .color-dot.selected { border-color: #1d1d1f; }
    </style>
</head>
<body>
<div class="window">
    <div class="title-bar">
        <div class="dots"><div class="dot r"></div><div class="dot y"></div><div class="dot g"></div></div>
        <div class="bar-title">Bookshelves</div>
        <div class="nav-controls">
            <button class="circle-btn" id="pBtn" onclick="mv(-1)">â†</button>
            <button class="circle-btn active" id="nBtn" onclick="mv(1)">â†’</button>
        </div>
    </div>
    <div class="step active" id="s1">
        <h1>Connect Notion</h1>
        <p class="desc">â˜… ìš°ì„  API í† í°ì„ ë°œê¸‰ë°›ê³ , ì•„ì¹´ì´ë¹™ í˜ì´ì§€ì™€ ì—°ë™í•´ì£¼ì„¸ìš”.</p>
        <input type="password" id="tk" placeholder="secret_xxxx" onkeypress="if(event.keyCode==13)mv(1)">
        <a href="https://www.notion.so/profile/integrations" target="_blank" style="font-size:11px; color:var(--gray); text-decoration:none; margin-top:10px; display:block;">ë‚´ ì¸í‹°ê·¸ë ˆì´ì…˜ ë°”ë¡œê°€ê¸° â†—</a>
    </div>
    <div class="step" id="s2"><h1>Select Library</h1><p class="desc">ë„ì„œë¥¼ ì €ì¥í•  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p><select id="db"></select></div>
    <div class="step" id="s3"><h1>Personalize</h1><p class="desc">ì•Œë¼ë”˜ TTB í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p><input type="text" id="ttb" placeholder="ttbxxx" onkeypress="if(event.keyCode==13)mv(1)"></div>
    <div class="step" id="s4"><h1>Design</h1><p class="desc">í…Œë§ˆ ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”.</p>
        <div style="display:flex; gap:10px;" id="pal"></div>
    </div>
</div>
<script>
    let step = 1; let selCol = "#f7cbd6";
    const colors = ['#f7cbd6', '#f9d5bb', '#ffffff', '#f6e8b1', '#b4e4c0', '#aac4f2'];
    const SERVER = "https://bookshelves-server.onrender.com";

    window.onload = () => {
        document.getElementById('pal').innerHTML = colors.map(c => `<div class="color-dot" style="background:${c};" onclick="sel('${c}')"></div>`).join('');
        sel(selCol);
    };
    function sel(c) { selCol = c; document.querySelectorAll('.color-dot').forEach(d => d.style.borderColor = d.style.backgroundColor.includes(c) ? '#1d1d1f' : 'transparent'); }
    async function mv(n) {
        if(n === 1 && step === 1) {
            const res = await fetch(SERVER+'/api/notion/databases', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token:document.getElementById('tk').value}) });
            const dbs = await res.json();
            document.getElementById('db').innerHTML = dbs.map(d => `<option value="\${d.id}">\${d.title}</option>`).join('');
        }
        if(step + n === 5) return fin();
        document.getElementById('s'+step).classList.remove('active');
        step += n;
        document.getElementById('s'+step).classList.add('active');
    }
    function fin() {
        const p = new URLSearchParams({ t: btoa(document.getElementById('tk').value), d: btoa(document.getElementById('db').value), k: btoa(document.getElementById('ttb').value), bg: selCol.replace('#','') });
        navigator.clipboard.writeText(SERVER + '/widget?' + p.toString());
        alert('ë³µì‚¬ ì™„ë£Œ! ë…¸ì…˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ğŸ¤');
    }
</script>
</body>
</html>
